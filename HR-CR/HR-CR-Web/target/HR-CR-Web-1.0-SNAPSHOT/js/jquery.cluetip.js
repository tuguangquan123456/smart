(function($){var O,P,Q,R,S,T,U;$.fn.cluetip=function(M){var N={width:275,height:'auto',cluezIndex:97,positionBy:'auto',topOffset:15,leftOffset:15,local:false,hideLocal:true,attribute:'rel',titleAttribute:'title',splitTitle:'',showTitle:true,cluetipClass:'default',hoverClass:'',waitImage:true,cursor:'help',arrows:false,dropShadow:true,dropShadowSteps:6,sticky:false,mouseOutClose:false,activation:'hover',closePosition:'top',closeText:'Close',truncate:0,fx:{open:'show',openSpeed:''},hoverIntent:{sensitivity:3,interval:50,timeout:0},onActivate:function(e){return true},onShow:function(a,c){},ajaxCache:true,ajaxProcess:function(a){a=$(a).not('style, meta, link, script, title');return a},ajaxSettings:{dataType:'html'}};if(M&&M.ajaxSettings){$.extend(N.ajaxSettings,M.ajaxSettings);delete M.ajaxSettings}if(M&&M.fx){$.extend(N.fx,M.fx);delete M.fx}if(M&&M.hoverIntent){$.extend(N.hoverIntent,M.hoverIntent);delete M.hoverIntent}$.extend(N,M);return this.each(function(){var g=false;var h=parseInt(N.cluezIndex,10)-1;var j=false;if(!O){P=$('<div id="cluetip-inner"></div>');R=$('<h3 id="cluetip-title"></h3>');Q=$('<div id="cluetip-outer"></div>').append(P).prepend(R);O=$('<div></div>').attr({'id':'cluetip'}).css({zIndex:N.cluezIndex}).append(Q).append('<div id="cluetip-extra"></div>')[V](W).hide();$('<div id="cluetip-waitimage"></div>').css({position:'absolute',zIndex:h-1}).insertBefore('#cluetip').hide();O.css({position:'absolute',zIndex:h});Q.css({position:'relative',zIndex:h+1});S=$('<div id="cluetip-arrows" class="cluetip-arrows"></div>').css({zIndex:h+1}).appendTo('#cluetip')}var k=(N.dropShadow)?+N.dropShadowSteps:0;if(!T){T=$([]);for(var i=0;i<k;i++){T=T.add($('<div></div>').css({zIndex:h-i-1,opacity:.1,top:1+i,left:1+i}))};T.css({position:'absolute',backgroundColor:'#000'}).prependTo(O)}var l=$(this);var m=l.attr(N.attribute),n=N.cluetipClass;if(!m&&!N.splitTitle)return true;if(N.local&&N.hideLocal){$(m+':first').hide()}var o=parseInt(N.topOffset,10),p=parseInt(N.leftOffset,10);var q,r;var s=isNaN(parseInt(N.height,10))?'auto':(/\D/g).test(N.height)?N.height:N.height+'px';var t,u,v,w,x;var y=parseInt(N.width,10)+parseInt(O.css('paddingLeft'))+parseInt(O.css('paddingRight'))+k;if(isNaN(y))y=275;var z=this.offsetWidth;var A,B,C,D,E;var F;var G=(N.attribute!='title')?l.attr(N.titleAttribute):'';if(N.splitTitle){F=G.split(N.splitTitle);G=F.shift()}var H;var I=function(b){if(!N.onActivate(l)){return false}j=true;O.removeClass().css({width:N.width});if(m==l.attr('href')){l.css('cursor',N.cursor)}l.attr('title','');if(N.hoverClass){l.addClass(N.hoverClass)}u=v=l.offset().top;A=l.offset().left;D=b.pageX;x=b.pageY;if(l[0].tagName.toLowerCase()!='area'){t=$(document).scrollTop();E=$(window).width()}if(N.positionBy=='fixed'){B=z+A+p;O.css({left:B})}else{B=(z>A&&A>y)||A+z+y+p>E?A-y-p:z+A+p;if(l[0].tagName.toLowerCase()=='area'||N.positionBy=='mouse'||z+y>E){if(D+20+y>E){B=(D-y-p)>=0?D-y-p:D-(y/2)}else{B=D+p}var c=B<0?b.pageY+o:b.pageY}O.css({left:(B>0&&N.positionBy!='bottomTop')?B:(D+(y/2)>E)?E/2-y/2:Math.max(D-(y/2),0)})}r=$(window).height();if(F){for(var i=0;i<F.length;i++){if(i==0){P.html(F[i])}else{P.append('<div class="split-body">'+F[i]+'</div>')}};J(c)}else if(!N.local&&m.indexOf('#')!=0){if(g&&N.ajaxCache){P.html(g);J(c)}else{var d=N.ajaxSettings;d.url=m;d.beforeSend=function(){Q.children().empty();if(N.waitImage){$('#cluetip-waitimage').css({top:x-10,left:parseInt(B+(y/2),10)}).show()}};d.error=function(){if(j){P.html('<i>sorry, the contents could not be loaded</i>')}};d.success=function(a){g=N.ajaxProcess(a);if(j){P.html(g)}};d.complete=function(){U=$('#cluetip-inner img').length;if(U){$('#cluetip-inner img').load(function(){U--;if(U<1){$('#cluetip-waitimage').hide();if(j)J(c)}})}else{$('#cluetip-waitimage').hide();if(j)J(c)}};$.ajax(d)}}else if(N.local){var e=$(m+':first');var f=$.fn.wrapInner?e.wrapInner('<div></div>').children().clone(true):e.html();$.fn.wrapInner?P.empty().append(f):P.html(f);J(c)}};var J=function(a){O.addClass('cluetip-'+n);if(N.truncate){var b=P.text().slice(0,N.truncate)+'...';P.html(b)}function doNothing(){};G?R.show().html(G):(N.showTitle)?R.show().html(' '):R.hide();if(N.sticky){var c=$('<div id="cluetip-close"><a href="#">'+N.closeText+'</a></div>');(N.closePosition=='bottom')?c.appendTo(P):(N.closePosition=='title')?c.prependTo(R):c.prependTo(P);c.click(function(){L();return false});if(N.mouseOutClose){O.hover(function(){doNothing()},function(){c.trigger('click')})}else{O.unbind('mouseout')}}var d='';Q.css({overflow:s=='auto'?'visible':'auto',height:s});q=s=='auto'?O.outerHeight():parseInt(s,10);w=v;if(N.positionBy=='fixed'){w=v-N.dropShadowSteps+o}else if((B<D&&Math.max(B,0)+y>D)||N.positionBy=='bottomTop'){if(v+q+o>t+r&&x-t>q+o){w=x-q-o;d='top'}else{w=x+o;d='bottom'}}else if(v+q+o>t+r){w=(q>=r)?t:t+r-q-o}else if(l.css('display')=='block'||l[0].tagName.toLowerCase()=='area'||N.positionBy=="mouse"){w=a-o}else{w=v-N.dropShadowSteps}if(d==''){B<A?d='left':d='right'}O.css({top:w+'px'}).removeClass().addClass('clue-'+d+'-'+n).addClass(' cluetip-'+n);if(N.arrows){var e=(v-w-N.dropShadowSteps);S.css({top:(/(left|right)/.test(d)&&B>=0&&e>0)?e+'px':/(left|right)/.test(d)?0:''}).show()}else{S.hide()}T.hide();O.hide()[N.fx.open](N.fx.open!='show'&&N.fx.openSpeed);if(N.dropShadow)T.css({height:q,width:N.width}).show();N.onShow(O,P)};var K=function(){j=false;$('#cluetip-waitimage').hide();if(!N.sticky){L()};if(N.hoverClass){l.removeClass(N.hoverClass)}};var L=function(){Q.parent().hide().removeClass().end().children().empty();if(G){l.attr('title',G)}l.css('cursor','');if(N.arrows)S.css({top:''})};if(N.activation=='click'||N.activation=='toggle'){l.click(function(a){if(O.is(':hidden')){I(a)}else{K(a)}this.blur();return false})}else{l.click(function(){if(m==l.attr('href')){return false}});if($.fn.hoverIntent&&N.hoverIntent){l.hoverIntent({sensitivity:N.hoverIntent.sensitivity,interval:N.hoverIntent.interval,over:function(a){I(a)},timeout:N.hoverIntent.timeout,out:function(a){K(a)}})}else{l.hover(function(a){I(a)},function(a){K(a)})}}})};var V='appendTo',W='body';$.cluetip={};$.cluetip.setup=function(a){if(a&&a.insertionType&&(a.insertionType).match(/appendTo|prependTo|insertBefore|insertAfter/)){V=a.insertionType}if(a&&a.insertionElement){W=a.insertionElement}}})(jQuery);
